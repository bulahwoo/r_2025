R Basics Part 3
================
Bulah Wu
18 September 2025

------------------------------------------------------------------------

``` r
getwd()
dir.create("~/KMB925/r_day2") # feel free to modify as needed
setwd("~/KMB925/r_day2")
```

``` r
bbcars <- mtcars[1:10, c(2:5, 7)]
ddcars <- data.frame(bbcars, price=c(100, 200, NA, 300, 400, NA, 500, 600, 700, NA))
```

- Use `is.na()` to check if an element is `NA`, which means ‘Not
  Available’ / Missing Values

``` r
is.na(ddcars$price)
```

    ##  [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE

``` r
ddcars[is.na(ddcars$price) ,]
```

    ##            cyl  disp  hp drat  qsec price
    ## Datsun 710   4 108.0  93 3.85 18.61    NA
    ## Valiant      6 225.0 105 2.76 20.22    NA
    ## Merc 280     6 167.6 123 3.92 18.30    NA

- Use `!is.na()` to check if an element is **NOT** `NA`. The logical NOT
  operator `!` negates the logical values returned by `is.na()`.

``` r
!is.na(ddcars$price)
```

    ##  [1]  TRUE  TRUE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE

``` r
ddcars[!is.na(ddcars$price) ,]
```

    ##                   cyl  disp  hp drat  qsec price
    ## Mazda RX4           6 160.0 110 3.90 16.46   100
    ## Mazda RX4 Wag       6 160.0 110 3.90 17.02   200
    ## Hornet 4 Drive      6 258.0 110 3.08 19.44   300
    ## Hornet Sportabout   8 360.0 175 3.15 17.02   400
    ## Duster 360          8 360.0 245 3.21 15.84   500
    ## Merc 240D           4 146.7  62 3.69 20.00   600
    ## Merc 230            4 140.8  95 3.92 22.90   700

------------------------------------------------------------------------

# Data manipulation with {dplyr}

## Install and load R package {dplyr}

- Use the function install.packages() to install packages from the CRAN
  repository (Comprehensive R Archive Network)

``` r
install.packages("dplyr")
```

- Use the function library() to load packages into the R session

``` r
library(dplyr)
```

------------------------------------------------------------------------

- Use function `download.file()` to download raw data

``` r
download.file("https://raw.githubusercontent.com/bulahwoo/r_2025/refs/heads/main/misc/rawdata_cat.tsv", destfile = "./rawdata_cat.tsv")
```

- Import data with `read.table()`

``` r
catdata <- read.table("./rawdata_cat.tsv", header = TRUE, sep = "\t")
```

------------------------------------------------------------------------

- Check the first few lines of the data frame `catdata`.

``` r
head(catdata)
```

    ##                breed weight length age residence    health food
    ## 1            Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet
    ## 2             Bengal    3.6  103.2 6.0     Czech       Bad  Dry
    ## 3            Persian    8.0   62.3 8.5     Italy Excellent  Wet
    ## 4             Bengal   18.8  100.3 3.5     Italy Excellent  Wet
    ## 5            Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry
    ## 6 American shorthair   14.4   84.9 7.8     Italy     Great  Wet

------------------------------------------------------------------------

- Check the structure:

``` r
str(catdata)
```

    ## 'data.frame':    30 obs. of  7 variables:
    ##  $ breed    : chr  "Ragdoll" "Bengal" "Persian" "Bengal" ...
    ##  $ weight   : num  17.7 3.6 8 18.8 18.5 14.4 8.9 2.2 15 10.7 ...
    ##  $ length   : num  99.6 103.2 62.3 100.3 99.7 ...
    ##  $ age      : num  1.2 6 8.5 3.5 3.2 7.8 2.5 8.4 7.5 3.1 ...
    ##  $ residence: chr  "Italy" "Czech" "Italy" "Italy" ...
    ##  $ health   : chr  "Okay" "Bad" "Excellent" "Excellent" ...
    ##  $ food     : chr  "Wet" "Dry" "Wet" "Wet" ...

![](misc/gap.png)  

## The pipe operator `%>%`

- Comes from the {magrittr} package

- make code more readable by chaining operations

- Syntax: VALUE `%>%` FUNCTION

``` r
mtcars[mtcars$cyl >= 6 & mtcars$gear == 5, ]
```

    ##                 mpg cyl disp  hp drat   wt qsec vs am gear carb
    ## Ford Pantera L 15.8   8  351 264 4.22 3.17 14.5  0  1    5    4
    ## Ferrari Dino   19.7   6  145 175 3.62 2.77 15.5  0  1    5    6
    ## Maserati Bora  15.0   8  301 335 3.54 3.57 14.6  0  1    5    8

``` r
sum(mtcars[mtcars$cyl >= 6 & mtcars$gear == 5, ]$mpg)
```

    ## [1] 50.5

![](misc/gap.png)  

## select(): select columns

- Specify the columns you need

``` r
catdata %>% select(breed, age, residence)
```

    ##                 breed age residence
    ## 1             Ragdoll 1.2     Italy
    ## 2              Bengal 6.0     Czech
    ## 3             Persian 8.5     Italy
    ## 4              Bengal 3.5     Italy
    ## 5             Ragdoll 3.2     Italy
    ## 6  American shorthair 7.8     Italy
    ## 7   British shorthair 2.5     Italy
    ## 8   British shorthair 8.4     Czech
    ## 9             Persian 7.5     Italy
    ## 10            Ragdoll 3.1    Norway
    ## 11             Bengal 4.6     Czech
    ## 12             Bengal 4.1    Norway
    ## 13             Bengal 3.3     Italy
    ## 14            Persian 1.4     Czech
    ## 15 American shorthair 9.1    Norway
    ## 16 American shorthair 1.5     Italy
    ## 17             Bengal 8.4     Czech
    ## 18 American shorthair 5.4     Italy
    ## 19             Bengal 1.2     Italy
    ## 20 American shorthair 0.4     Czech
    ## 21            Persian 2.8     Italy
    ## 22  British shorthair 8.8    Norway
    ## 23            Ragdoll 8.4     Italy
    ## 24             Bengal 0.6     Italy
    ## 25 American shorthair 0.5     Italy
    ## 26            Ragdoll 3.2     Czech
    ## 27             Bengal 1.3     Italy
    ## 28            Ragdoll 0.4     Italy
    ## 29  British shorthair 1.2     Czech
    ## 30 American shorthair 5.7     Czech

------------------------------------------------------------------------

- Specify the columns you don’t need: add a minus sign (-) to the column
  names as a prefix

``` r
catdata %>% select(-breed, -age, -residence)
```

    ##    weight length    health food
    ## 1    17.7   99.6      Okay  Wet
    ## 2     3.6  103.2       Bad  Dry
    ## 3     8.0   62.3 Excellent  Wet
    ## 4    18.8  100.3 Excellent  Wet
    ## 5    18.5   99.7      Okay  Dry
    ## 6    14.4   84.9     Great  Wet
    ## 7     8.9   90.0     Great  Dry
    ## 8     2.2   79.1 Excellent  Dry
    ## 9    15.0   90.0      Okay  Dry
    ## 10   10.7   46.4      Okay  Dry
    ## 11    2.1   55.1       Bad  Wet
    ## 12   12.3   85.9      Okay  Wet
    ## 13    3.5   41.9      Okay  Wet
    ## 14    8.8   81.0 Excellent  Wet
    ## 15   20.0   83.7     Great  Wet
    ## 16    3.8   69.4     Great  Dry
    ## 17   16.5   83.9     Great  Wet
    ## 18    3.5   40.6      Okay  Wet
    ## 19   17.8   44.1       Bad  Wet
    ## 20   19.7   58.2     Great  Wet
    ## 21   13.0   70.4     Great  Wet
    ## 22   14.3   90.5      Okay  Wet
    ## 23   10.9   63.9       Bad  Wet
    ## 24    7.0   98.5     Great  Wet
    ## 25    2.1   73.9       Bad  Dry
    ## 26   14.0   58.8       Bad  Wet
    ## 27   11.9   55.9      Okay  Dry
    ## 28   12.7   78.3 Excellent  Wet
    ## 29    7.6   64.7       Bad  Wet
    ## 30   18.2   85.9       Bad  Dry

![](misc/gap.png)  

## slice_min() and slice_max(): select rows

- slice_min(): select rows with the smallest values of a variable
  (column).

``` r
catdata %>% slice_min(weight, n = 5)
```

    ##                breed weight length age residence    health food
    ## 1             Bengal    2.1   55.1 4.6     Czech       Bad  Wet
    ## 2 American shorthair    2.1   73.9 0.5     Italy       Bad  Dry
    ## 3  British shorthair    2.2   79.1 8.4     Czech Excellent  Dry
    ## 4             Bengal    3.5   41.9 3.3     Italy      Okay  Wet
    ## 5 American shorthair    3.5   40.6 5.4     Italy      Okay  Wet

------------------------------------------------------------------------

- slice_max(): select rows with the largest values of a variable
  (column).

``` r
catdata %>% slice_max(length, n = 5)
```

    ##     breed weight length age residence    health food
    ## 1  Bengal    3.6  103.2 6.0     Czech       Bad  Dry
    ## 2  Bengal   18.8  100.3 3.5     Italy Excellent  Wet
    ## 3 Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry
    ## 4 Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet
    ## 5  Bengal    7.0   98.5 0.6     Italy     Great  Wet

![](misc/gap.png)  

## filter(): filter data by setting condition(s)

- Show only `residence is "Czech"`

``` r
catdata %>% filter(residence == "Czech")
```

    ##                breed weight length age residence    health food
    ## 1             Bengal    3.6  103.2 6.0     Czech       Bad  Dry
    ## 2  British shorthair    2.2   79.1 8.4     Czech Excellent  Dry
    ## 3             Bengal    2.1   55.1 4.6     Czech       Bad  Wet
    ## 4            Persian    8.8   81.0 1.4     Czech Excellent  Wet
    ## 5             Bengal   16.5   83.9 8.4     Czech     Great  Wet
    ## 6 American shorthair   19.7   58.2 0.4     Czech     Great  Wet
    ## 7            Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet
    ## 8  British shorthair    7.6   64.7 1.2     Czech       Bad  Wet
    ## 9 American shorthair   18.2   85.9 5.7     Czech       Bad  Dry

------------------------------------------------------------------------

- Show only `residence is "Czech" or "Italy"`

``` r
catdata %>% filter(residence %in% c("Czech", "Italy"))
```

    ##                 breed weight length age residence    health food
    ## 1             Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet
    ## 2              Bengal    3.6  103.2 6.0     Czech       Bad  Dry
    ## 3             Persian    8.0   62.3 8.5     Italy Excellent  Wet
    ## 4              Bengal   18.8  100.3 3.5     Italy Excellent  Wet
    ## 5             Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry
    ## 6  American shorthair   14.4   84.9 7.8     Italy     Great  Wet
    ## 7   British shorthair    8.9   90.0 2.5     Italy     Great  Dry
    ## 8   British shorthair    2.2   79.1 8.4     Czech Excellent  Dry
    ## 9             Persian   15.0   90.0 7.5     Italy      Okay  Dry
    ## 10             Bengal    2.1   55.1 4.6     Czech       Bad  Wet
    ## 11             Bengal    3.5   41.9 3.3     Italy      Okay  Wet
    ## 12            Persian    8.8   81.0 1.4     Czech Excellent  Wet
    ## 13 American shorthair    3.8   69.4 1.5     Italy     Great  Dry
    ## 14             Bengal   16.5   83.9 8.4     Czech     Great  Wet
    ## 15 American shorthair    3.5   40.6 5.4     Italy      Okay  Wet
    ## 16             Bengal   17.8   44.1 1.2     Italy       Bad  Wet
    ## 17 American shorthair   19.7   58.2 0.4     Czech     Great  Wet
    ## 18            Persian   13.0   70.4 2.8     Italy     Great  Wet
    ## 19            Ragdoll   10.9   63.9 8.4     Italy       Bad  Wet
    ## 20             Bengal    7.0   98.5 0.6     Italy     Great  Wet
    ## 21 American shorthair    2.1   73.9 0.5     Italy       Bad  Dry
    ## 22            Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet
    ## 23             Bengal   11.9   55.9 1.3     Italy      Okay  Dry
    ## 24            Ragdoll   12.7   78.3 0.4     Italy Excellent  Wet
    ## 25  British shorthair    7.6   64.7 1.2     Czech       Bad  Wet
    ## 26 American shorthair   18.2   85.9 5.7     Czech       Bad  Dry

------------------------------------------------------------------------

- Show only `weight > 10` and `age < 4`

``` r
catdata %>% filter(weight > 10, age < 4)
```

    ##                 breed weight length age residence    health food
    ## 1             Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet
    ## 2              Bengal   18.8  100.3 3.5     Italy Excellent  Wet
    ## 3             Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry
    ## 4             Ragdoll   10.7   46.4 3.1    Norway      Okay  Dry
    ## 5              Bengal   17.8   44.1 1.2     Italy       Bad  Wet
    ## 6  American shorthair   19.7   58.2 0.4     Czech     Great  Wet
    ## 7             Persian   13.0   70.4 2.8     Italy     Great  Wet
    ## 8             Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet
    ## 9              Bengal   11.9   55.9 1.3     Italy      Okay  Dry
    ## 10            Ragdoll   12.7   78.3 0.4     Italy Excellent  Wet

![](misc/gap.png)  

## arrange(): sort data

- Sort data by a specific column value in **ascending** order (from the
  smallest to the largest)

``` r
catdata %>% arrange(length)
```

    ##                 breed weight length age residence    health food
    ## 1  American shorthair    3.5   40.6 5.4     Italy      Okay  Wet
    ## 2              Bengal    3.5   41.9 3.3     Italy      Okay  Wet
    ## 3              Bengal   17.8   44.1 1.2     Italy       Bad  Wet
    ## 4             Ragdoll   10.7   46.4 3.1    Norway      Okay  Dry
    ## 5              Bengal    2.1   55.1 4.6     Czech       Bad  Wet
    ## 6              Bengal   11.9   55.9 1.3     Italy      Okay  Dry
    ## 7  American shorthair   19.7   58.2 0.4     Czech     Great  Wet
    ## 8             Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet
    ## 9             Persian    8.0   62.3 8.5     Italy Excellent  Wet
    ## 10            Ragdoll   10.9   63.9 8.4     Italy       Bad  Wet
    ## 11  British shorthair    7.6   64.7 1.2     Czech       Bad  Wet
    ## 12 American shorthair    3.8   69.4 1.5     Italy     Great  Dry
    ## 13            Persian   13.0   70.4 2.8     Italy     Great  Wet
    ## 14 American shorthair    2.1   73.9 0.5     Italy       Bad  Dry
    ## 15            Ragdoll   12.7   78.3 0.4     Italy Excellent  Wet
    ## 16  British shorthair    2.2   79.1 8.4     Czech Excellent  Dry
    ## 17            Persian    8.8   81.0 1.4     Czech Excellent  Wet
    ## 18 American shorthair   20.0   83.7 9.1    Norway     Great  Wet
    ## 19             Bengal   16.5   83.9 8.4     Czech     Great  Wet
    ## 20 American shorthair   14.4   84.9 7.8     Italy     Great  Wet
    ## 21             Bengal   12.3   85.9 4.1    Norway      Okay  Wet
    ## 22 American shorthair   18.2   85.9 5.7     Czech       Bad  Dry
    ## 23  British shorthair    8.9   90.0 2.5     Italy     Great  Dry
    ## 24            Persian   15.0   90.0 7.5     Italy      Okay  Dry
    ## 25  British shorthair   14.3   90.5 8.8    Norway      Okay  Wet
    ## 26             Bengal    7.0   98.5 0.6     Italy     Great  Wet
    ## 27            Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet
    ## 28            Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry
    ## 29             Bengal   18.8  100.3 3.5     Italy Excellent  Wet
    ## 30             Bengal    3.6  103.2 6.0     Czech       Bad  Dry

------------------------------------------------------------------------

- Sort data by a specific column value in **descending** order (from the
  largest to the smallest)

``` r
catdata %>% arrange(desc(length))
```

    ##                 breed weight length age residence    health food
    ## 1              Bengal    3.6  103.2 6.0     Czech       Bad  Dry
    ## 2              Bengal   18.8  100.3 3.5     Italy Excellent  Wet
    ## 3             Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry
    ## 4             Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet
    ## 5              Bengal    7.0   98.5 0.6     Italy     Great  Wet
    ## 6   British shorthair   14.3   90.5 8.8    Norway      Okay  Wet
    ## 7   British shorthair    8.9   90.0 2.5     Italy     Great  Dry
    ## 8             Persian   15.0   90.0 7.5     Italy      Okay  Dry
    ## 9              Bengal   12.3   85.9 4.1    Norway      Okay  Wet
    ## 10 American shorthair   18.2   85.9 5.7     Czech       Bad  Dry
    ## 11 American shorthair   14.4   84.9 7.8     Italy     Great  Wet
    ## 12             Bengal   16.5   83.9 8.4     Czech     Great  Wet
    ## 13 American shorthair   20.0   83.7 9.1    Norway     Great  Wet
    ## 14            Persian    8.8   81.0 1.4     Czech Excellent  Wet
    ## 15  British shorthair    2.2   79.1 8.4     Czech Excellent  Dry
    ## 16            Ragdoll   12.7   78.3 0.4     Italy Excellent  Wet
    ## 17 American shorthair    2.1   73.9 0.5     Italy       Bad  Dry
    ## 18            Persian   13.0   70.4 2.8     Italy     Great  Wet
    ## 19 American shorthair    3.8   69.4 1.5     Italy     Great  Dry
    ## 20  British shorthair    7.6   64.7 1.2     Czech       Bad  Wet
    ## 21            Ragdoll   10.9   63.9 8.4     Italy       Bad  Wet
    ## 22            Persian    8.0   62.3 8.5     Italy Excellent  Wet
    ## 23            Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet
    ## 24 American shorthair   19.7   58.2 0.4     Czech     Great  Wet
    ## 25             Bengal   11.9   55.9 1.3     Italy      Okay  Dry
    ## 26             Bengal    2.1   55.1 4.6     Czech       Bad  Wet
    ## 27            Ragdoll   10.7   46.4 3.1    Norway      Okay  Dry
    ## 28             Bengal   17.8   44.1 1.2     Italy       Bad  Wet
    ## 29             Bengal    3.5   41.9 3.3     Italy      Okay  Wet
    ## 30 American shorthair    3.5   40.6 5.4     Italy      Okay  Wet

------------------------------------------------------------------------

- Sort data by two specific column values

``` r
catdata %>% arrange(residence, desc(length))
```

    ##                 breed weight length age residence    health food
    ## 1              Bengal    3.6  103.2 6.0     Czech       Bad  Dry
    ## 2  American shorthair   18.2   85.9 5.7     Czech       Bad  Dry
    ## 3              Bengal   16.5   83.9 8.4     Czech     Great  Wet
    ## 4             Persian    8.8   81.0 1.4     Czech Excellent  Wet
    ## 5   British shorthair    2.2   79.1 8.4     Czech Excellent  Dry
    ## 6   British shorthair    7.6   64.7 1.2     Czech       Bad  Wet
    ## 7             Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet
    ## 8  American shorthair   19.7   58.2 0.4     Czech     Great  Wet
    ## 9              Bengal    2.1   55.1 4.6     Czech       Bad  Wet
    ## 10             Bengal   18.8  100.3 3.5     Italy Excellent  Wet
    ## 11            Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry
    ## 12            Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet
    ## 13             Bengal    7.0   98.5 0.6     Italy     Great  Wet
    ## 14  British shorthair    8.9   90.0 2.5     Italy     Great  Dry
    ## 15            Persian   15.0   90.0 7.5     Italy      Okay  Dry
    ## 16 American shorthair   14.4   84.9 7.8     Italy     Great  Wet
    ## 17            Ragdoll   12.7   78.3 0.4     Italy Excellent  Wet
    ## 18 American shorthair    2.1   73.9 0.5     Italy       Bad  Dry
    ## 19            Persian   13.0   70.4 2.8     Italy     Great  Wet
    ## 20 American shorthair    3.8   69.4 1.5     Italy     Great  Dry
    ## 21            Ragdoll   10.9   63.9 8.4     Italy       Bad  Wet
    ## 22            Persian    8.0   62.3 8.5     Italy Excellent  Wet
    ## 23             Bengal   11.9   55.9 1.3     Italy      Okay  Dry
    ## 24             Bengal   17.8   44.1 1.2     Italy       Bad  Wet
    ## 25             Bengal    3.5   41.9 3.3     Italy      Okay  Wet
    ## 26 American shorthair    3.5   40.6 5.4     Italy      Okay  Wet
    ## 27  British shorthair   14.3   90.5 8.8    Norway      Okay  Wet
    ## 28             Bengal   12.3   85.9 4.1    Norway      Okay  Wet
    ## 29 American shorthair   20.0   83.7 9.1    Norway     Great  Wet
    ## 30            Ragdoll   10.7   46.4 3.1    Norway      Okay  Dry

![](misc/gap.png)  

## mutate(): create new columns using existing columns

- Create a new column `half_length`, which equals to `length / 2`.

``` r
catdata %>% mutate(half_length = length / 2)
```

    ##                 breed weight length age residence    health food half_length
    ## 1             Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet       49.80
    ## 2              Bengal    3.6  103.2 6.0     Czech       Bad  Dry       51.60
    ## 3             Persian    8.0   62.3 8.5     Italy Excellent  Wet       31.15
    ## 4              Bengal   18.8  100.3 3.5     Italy Excellent  Wet       50.15
    ## 5             Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry       49.85
    ## 6  American shorthair   14.4   84.9 7.8     Italy     Great  Wet       42.45
    ## 7   British shorthair    8.9   90.0 2.5     Italy     Great  Dry       45.00
    ## 8   British shorthair    2.2   79.1 8.4     Czech Excellent  Dry       39.55
    ## 9             Persian   15.0   90.0 7.5     Italy      Okay  Dry       45.00
    ## 10            Ragdoll   10.7   46.4 3.1    Norway      Okay  Dry       23.20
    ## 11             Bengal    2.1   55.1 4.6     Czech       Bad  Wet       27.55
    ## 12             Bengal   12.3   85.9 4.1    Norway      Okay  Wet       42.95
    ## 13             Bengal    3.5   41.9 3.3     Italy      Okay  Wet       20.95
    ## 14            Persian    8.8   81.0 1.4     Czech Excellent  Wet       40.50
    ## 15 American shorthair   20.0   83.7 9.1    Norway     Great  Wet       41.85
    ## 16 American shorthair    3.8   69.4 1.5     Italy     Great  Dry       34.70
    ## 17             Bengal   16.5   83.9 8.4     Czech     Great  Wet       41.95
    ## 18 American shorthair    3.5   40.6 5.4     Italy      Okay  Wet       20.30
    ## 19             Bengal   17.8   44.1 1.2     Italy       Bad  Wet       22.05
    ## 20 American shorthair   19.7   58.2 0.4     Czech     Great  Wet       29.10
    ## 21            Persian   13.0   70.4 2.8     Italy     Great  Wet       35.20
    ## 22  British shorthair   14.3   90.5 8.8    Norway      Okay  Wet       45.25
    ## 23            Ragdoll   10.9   63.9 8.4     Italy       Bad  Wet       31.95
    ## 24             Bengal    7.0   98.5 0.6     Italy     Great  Wet       49.25
    ## 25 American shorthair    2.1   73.9 0.5     Italy       Bad  Dry       36.95
    ## 26            Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet       29.40
    ## 27             Bengal   11.9   55.9 1.3     Italy      Okay  Dry       27.95
    ## 28            Ragdoll   12.7   78.3 0.4     Italy Excellent  Wet       39.15
    ## 29  British shorthair    7.6   64.7 1.2     Czech       Bad  Wet       32.35
    ## 30 American shorthair   18.2   85.9 5.7     Czech       Bad  Dry       42.95

------------------------------------------------------------------------

- Create a new column `ratio`, which equals to `length / weight`.

``` r
catdata %>% mutate(ratio = length / weight)
```

    ##                 breed weight length age residence    health food     ratio
    ## 1             Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet  5.627119
    ## 2              Bengal    3.6  103.2 6.0     Czech       Bad  Dry 28.666667
    ## 3             Persian    8.0   62.3 8.5     Italy Excellent  Wet  7.787500
    ## 4              Bengal   18.8  100.3 3.5     Italy Excellent  Wet  5.335106
    ## 5             Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry  5.389189
    ## 6  American shorthair   14.4   84.9 7.8     Italy     Great  Wet  5.895833
    ## 7   British shorthair    8.9   90.0 2.5     Italy     Great  Dry 10.112360
    ## 8   British shorthair    2.2   79.1 8.4     Czech Excellent  Dry 35.954545
    ## 9             Persian   15.0   90.0 7.5     Italy      Okay  Dry  6.000000
    ## 10            Ragdoll   10.7   46.4 3.1    Norway      Okay  Dry  4.336449
    ## 11             Bengal    2.1   55.1 4.6     Czech       Bad  Wet 26.238095
    ## 12             Bengal   12.3   85.9 4.1    Norway      Okay  Wet  6.983740
    ## 13             Bengal    3.5   41.9 3.3     Italy      Okay  Wet 11.971429
    ## 14            Persian    8.8   81.0 1.4     Czech Excellent  Wet  9.204545
    ## 15 American shorthair   20.0   83.7 9.1    Norway     Great  Wet  4.185000
    ## 16 American shorthair    3.8   69.4 1.5     Italy     Great  Dry 18.263158
    ## 17             Bengal   16.5   83.9 8.4     Czech     Great  Wet  5.084848
    ## 18 American shorthair    3.5   40.6 5.4     Italy      Okay  Wet 11.600000
    ## 19             Bengal   17.8   44.1 1.2     Italy       Bad  Wet  2.477528
    ## 20 American shorthair   19.7   58.2 0.4     Czech     Great  Wet  2.954315
    ## 21            Persian   13.0   70.4 2.8     Italy     Great  Wet  5.415385
    ## 22  British shorthair   14.3   90.5 8.8    Norway      Okay  Wet  6.328671
    ## 23            Ragdoll   10.9   63.9 8.4     Italy       Bad  Wet  5.862385
    ## 24             Bengal    7.0   98.5 0.6     Italy     Great  Wet 14.071429
    ## 25 American shorthair    2.1   73.9 0.5     Italy       Bad  Dry 35.190476
    ## 26            Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet  4.200000
    ## 27             Bengal   11.9   55.9 1.3     Italy      Okay  Dry  4.697479
    ## 28            Ragdoll   12.7   78.3 0.4     Italy Excellent  Wet  6.165354
    ## 29  British shorthair    7.6   64.7 1.2     Czech       Bad  Wet  8.513158
    ## 30 American shorthair   18.2   85.9 5.7     Czech       Bad  Dry  4.719780

![](misc/gap.png)  

## summarize(): summarize data

- Calculate the sum of `length` using the function `sum()`

``` r
catdata %>% summarize(sum_length = sum(length))
```

    ##   sum_length
    ## 1     2240.1

------------------------------------------------------------------------

- Calculate the mean of `length` using the function `mean()`

``` r
catdata %>% summarize(mean_length = mean(length))
```

    ##   mean_length
    ## 1       74.67

------------------------------------------------------------------------

- Count the size (number) of `food` using the function `n()`

``` r
catdata %>% summarize(number_food = n())
```

    ##   number_food
    ## 1          30

![](misc/gap.png)  

## group_by(): grouping data by one or more variables (columns)

- Group data frame `catdata` by `residence`, and calculate the sum of
  `length` using the function `sum()`

``` r
catdata %>% group_by(residence) %>% summarize(sum_length = sum(length))
```

    ## # A tibble: 3 × 2
    ##   residence sum_length
    ##   <chr>          <dbl>
    ## 1 Czech           670.
    ## 2 Italy          1264.
    ## 3 Norway          306.

------------------------------------------------------------------------

- Group data frame `catdata` by `residence`, and calculate the mean of
  `length` using the function `mean()`

``` r
catdata %>% group_by(residence) %>% summarize(mean_length = mean(length))
```

    ## # A tibble: 3 × 2
    ##   residence mean_length
    ##   <chr>           <dbl>
    ## 1 Czech            74.4
    ## 2 Italy            74.3
    ## 3 Norway           76.6

------------------------------------------------------------------------

- Group data frame `catdata` by `residence`, and count the size (number)
  of `food` using the function `n()`

``` r
catdata %>% group_by(residence) %>% summarize(number_food = n())
```

    ## # A tibble: 3 × 2
    ##   residence number_food
    ##   <chr>           <int>
    ## 1 Czech               9
    ## 2 Italy              17
    ## 3 Norway              4

![](misc/gap.png)  

## Exercise

- Consider the data frame `catdata`:

  - 1.  How many cats live in Czech?
  - 2.  How many cats prefer wet food and weigh more than 5 kg?
  - 3.  What is the health condition of the oldest cat in Norway?
  - 4.  Where does the cat of the longest body live?
  - 5.  Which country owns the largest number of Bengal?
  - 6.  Which country owns the largest number of cats whose health
        condition is either “Okay”, “Great”, or “Excellent”?
  - 7.  The unit for `age` variable is year. Add a new column
        ‘age_month’, which holds the value = age \* 12.
  - 8.  Show the data of the oldest cat in each country.
  - 9.  What is the average body length of cats who are older than 20
        months and prefer dry food in each country?

![](misc/gap02.png) ![](misc/gap02.png) ![](misc/gap02.png)
![](misc/gap02.png) ![](misc/gap02.png) ![](misc/gap02.png)
![](misc/gap02.png) ![](misc/gap02.png) ![](misc/gap02.png)
![](misc/gap02.png) ![](misc/gap02.png)  

## Solutions

- 1.  How many cats live in Czech?

``` r
catdata %>%
  filter(residence == "Czech") %>%
  summarize(number = n())
```

    ##   number
    ## 1      9

------------------------------------------------------------------------

- 2.  How many cats prefer wet food and weigh more than 5 kg?

``` r
catdata %>%
  filter(food == "Wet") %>%
  filter(weight > 5) %>%
  summarize(number = n())
```

    ##   number
    ## 1     17

------------------------------------------------------------------------

- 3.  What is the health condition of the oldest cat in Norway?

``` r
catdata %>%
  filter(residence == "Norway") %>%
  slice_max(age, n = 1) %>%
  select(health)
```

    ##   health
    ## 1  Great

------------------------------------------------------------------------

- 4.  Where does the cat of the longest body live?

``` r
catdata %>%
  slice_max(length, n = 1) %>%
  select(residence)
```

    ##   residence
    ## 1     Czech

------------------------------------------------------------------------

- 5.  Which country owns the largest number of Bengal?

``` r
catdata %>%
  filter(breed == "Bengal") %>%
  group_by(residence) %>%
  summarize(number = n()) %>%
  slice_max(number)
```

    ## # A tibble: 1 × 2
    ##   residence number
    ##   <chr>      <int>
    ## 1 Italy          5

------------------------------------------------------------------------

- 6.  Which country owns the largest number of cats whose health
      condition is either “Okay”, “Great”, or “Excellent”?

``` r
catdata %>%
  filter(health %in% c("Okay", "Great", "Excellent")) %>%
  group_by(residence) %>%
  summarize(number = n()) %>%
  slice_max(number)
```

    ## # A tibble: 1 × 2
    ##   residence number
    ##   <chr>      <int>
    ## 1 Italy         14

------------------------------------------------------------------------

- 7.  The unit for `age` variable is year. Add a new column ‘age_month’,
      which holds the value = age \* 12.

``` r
catdata %>%
  mutate(age_month = age * 12)
```

    ##                 breed weight length age residence    health food age_month
    ## 1             Ragdoll   17.7   99.6 1.2     Italy      Okay  Wet      14.4
    ## 2              Bengal    3.6  103.2 6.0     Czech       Bad  Dry      72.0
    ## 3             Persian    8.0   62.3 8.5     Italy Excellent  Wet     102.0
    ## 4              Bengal   18.8  100.3 3.5     Italy Excellent  Wet      42.0
    ## 5             Ragdoll   18.5   99.7 3.2     Italy      Okay  Dry      38.4
    ## 6  American shorthair   14.4   84.9 7.8     Italy     Great  Wet      93.6
    ## 7   British shorthair    8.9   90.0 2.5     Italy     Great  Dry      30.0
    ## 8   British shorthair    2.2   79.1 8.4     Czech Excellent  Dry     100.8
    ## 9             Persian   15.0   90.0 7.5     Italy      Okay  Dry      90.0
    ## 10            Ragdoll   10.7   46.4 3.1    Norway      Okay  Dry      37.2
    ## 11             Bengal    2.1   55.1 4.6     Czech       Bad  Wet      55.2
    ## 12             Bengal   12.3   85.9 4.1    Norway      Okay  Wet      49.2
    ## 13             Bengal    3.5   41.9 3.3     Italy      Okay  Wet      39.6
    ## 14            Persian    8.8   81.0 1.4     Czech Excellent  Wet      16.8
    ## 15 American shorthair   20.0   83.7 9.1    Norway     Great  Wet     109.2
    ## 16 American shorthair    3.8   69.4 1.5     Italy     Great  Dry      18.0
    ## 17             Bengal   16.5   83.9 8.4     Czech     Great  Wet     100.8
    ## 18 American shorthair    3.5   40.6 5.4     Italy      Okay  Wet      64.8
    ## 19             Bengal   17.8   44.1 1.2     Italy       Bad  Wet      14.4
    ## 20 American shorthair   19.7   58.2 0.4     Czech     Great  Wet       4.8
    ## 21            Persian   13.0   70.4 2.8     Italy     Great  Wet      33.6
    ## 22  British shorthair   14.3   90.5 8.8    Norway      Okay  Wet     105.6
    ## 23            Ragdoll   10.9   63.9 8.4     Italy       Bad  Wet     100.8
    ## 24             Bengal    7.0   98.5 0.6     Italy     Great  Wet       7.2
    ## 25 American shorthair    2.1   73.9 0.5     Italy       Bad  Dry       6.0
    ## 26            Ragdoll   14.0   58.8 3.2     Czech       Bad  Wet      38.4
    ## 27             Bengal   11.9   55.9 1.3     Italy      Okay  Dry      15.6
    ## 28            Ragdoll   12.7   78.3 0.4     Italy Excellent  Wet       4.8
    ## 29  British shorthair    7.6   64.7 1.2     Czech       Bad  Wet      14.4
    ## 30 American shorthair   18.2   85.9 5.7     Czech       Bad  Dry      68.4

------------------------------------------------------------------------

- 8.  Show the data of the oldest cat in each country.

``` r
catdata %>%
  group_by(residence) %>%
  slice_max(age, n = 1)
```

    ## # A tibble: 4 × 7
    ## # Groups:   residence [3]
    ##   breed              weight length   age residence health    food 
    ##   <chr>               <dbl>  <dbl> <dbl> <chr>     <chr>     <chr>
    ## 1 British shorthair     2.2   79.1   8.4 Czech     Excellent Dry  
    ## 2 Bengal               16.5   83.9   8.4 Czech     Great     Wet  
    ## 3 Persian               8     62.3   8.5 Italy     Excellent Wet  
    ## 4 American shorthair   20     83.7   9.1 Norway    Great     Wet

------------------------------------------------------------------------

- 9.  What is the average body length of cats who are older than 20
      months and prefer dry food in each country?

``` r
catdata %>%
  mutate(age_month = age * 12) %>%
  filter(age_month > 20, food == "Dry") %>%
  group_by(residence) %>%
  summarize(avg_length = mean(length))
```

    ## # A tibble: 3 × 2
    ##   residence avg_length
    ##   <chr>          <dbl>
    ## 1 Czech           89.4
    ## 2 Italy           93.2
    ## 3 Norway          46.4

![](misc/gap.png)  
